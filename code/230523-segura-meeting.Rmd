---
title: "050423-segura-meeting.Rmd"
output: html_document
date: "2023-04-05"
---

WARNING: THIS NOTEBOOK IS SPECFIC TO EPIDERMIS for simplicity. a different notebook will address dermis

## 0a. load libraries
```{r, load}
library(tidyverse)
library(dplyr)

conversion = 100/22  #write multiplication conversion factor here; currently holds test value
```


## 0b. Read in the epidermis and dermis pixel dataframes 
skip first column (it is just the number of rows)
```{r, open-dermis-and-epidermis-dfs}
all_epidermis <- read_csv(paste0("../data/","all_epidermis_lengths_in_pixels.csv"))
a<-length(colnames(all_epidermis))

all_dermis <- read_csv(paste0("../data/","all_dermis_lengths_in_pixels.csv"))
b<-length(colnames(all_dermis))

# skip first column (it is just the number of rows)
all_epidermis <- all_epidermis[,2:a]
all_dermis <- all_dermis[,2:b]

# apply conversion
all_epidermis_micron <- all_epidermis/conversion
all_dermis_micron <- all_dermis/conversion
```

## 0c. Rename epidermis and dermis df for readability
```{r, load-pixel-epiderm-derm}
all_dermis_lengths_in_pixels <- all_dermis
all_epidermis_lengths_in_pixels <- all_epidermis

all_dermis_lengths_in_microns <- all_dermis_micron
all_epidermis_lengths_in_microns <- all_epidermis_micron
```


## 1. visualize spread of each animal's EPIDERMIS lengths...
- use same binwidth and same axes
```{r, spread-epi-micron-data}
df_set1<-all_epidermis_lengths_in_microns[,1:6]
df_set2<-all_epidermis_lengths_in_microns[,7:12]
df_set3<-all_epidermis_lengths_in_microns[,13:18]
df_set4<-all_epidermis_lengths_in_microns[,19:24]
df_set5<-all_epidermis_lengths_in_microns[,25:30]

# convert data to long format using tidyr::pivot_longer()
long1 <- tidyr::pivot_longer(df_set1, everything())
long2 <- tidyr::pivot_longer(df_set2, everything())
long3 <- tidyr::pivot_longer(df_set3, everything())
long4 <- tidyr::pivot_longer(df_set4, everything())
long5 <- tidyr::pivot_longer(df_set5, everything())
```

### 1a. on scale of 0-125 microns
```{r, spread-epi-micron-histgraph}
# set y-axis range
x_range <- c(0,125)

# plot using ggplot and facet_wrap()
p1<-ggplot(long1[], aes(x = value)) +
  geom_histogram(color="black", fill="white", binwidth = 2) +
  facet_wrap(~ name, scales = "fixed") +
  labs(x = "Pixel Value", y = "Frequency")+
  scale_x_continuous(limits = x_range, expand = c(0, 0))+
  theme(axis.title.x = element_text())
p1
#ggsave("animal-pixel-lenght-spread1.jpg", plot = p1, dpi = 300, width = 6, height = 4, units = "in")

p2<-ggplot(long2[], aes(x = value)) +
  geom_histogram(color="black", fill="white", binwidth = 2) +
  facet_wrap(~ name, scales = "fixed") +
  labs(x = "Pixel Value", y = "Frequency")+
  scale_x_continuous(limits = x_range, expand = c(0, 0))+
  theme(axis.title.x = element_text())
p2
#ggsave("animal-pixel-lenght-spread2.jpg", plot = p2, dpi = 300, width = 6, height = 4, units = "in")

p3<-ggplot(long3[], aes(x = value)) +
  geom_histogram(color="black", fill="white", binwidth = 2) +
  facet_wrap(~ name, scales = "fixed") +
  labs(x = "Pixel Value", y = "Frequency")+
  scale_x_continuous(limits = x_range, expand = c(0, 0))+
  theme(axis.title.x = element_text())
p3
#ggsave("animal-pixel-lenght-spread3.jpg", plot = p3, dpi = 300, width = 6, height = 4, units = "in")

p4<-ggplot(long4[], aes(x = value)) +
  geom_histogram(color="black", fill="white", binwidth = 2) +
  facet_wrap(~ name, scales = "fixed") +
  labs(x = "Pixel Value", y = "Frequency")+
  scale_x_continuous(limits = x_range, expand = c(0, 0))+
  theme(axis.title.x = element_text())
p4
#ggsave("animal-pixel-lenght-spread4.jpg", plot = p4, dpi = 300, width = 6, height = 4, units = "in")

p5<-ggplot(long5[], aes(x = value)) +
  geom_histogram(color="black", fill="white", binwidth = 2) +
  facet_wrap(~ name, scales = "fixed") +
  labs(x = "Pixel Value", y = "Frequency")+
  scale_x_continuous(limits = x_range, expand = c(0, 0))+
  theme(axis.title.x = element_text()) 
p5
#ggsave("animal-pixel-lenght-spread5.jpg", plot = p5, dpi = 300, width = 6, height = 4, units = "in")
```

```{r, spread-epi-micron-densitygraph}
# set y-axis range
x_range <- c(0,125)

# plot using ggplot and facet_wrap()
p1<-ggplot(long1[], aes(x = value)) +
  geom_density(color="black", fill="darkgrey") +
  facet_wrap(~ name, scales = "fixed") +
   theme_minimal()+
  labs(x = "Pixel Value", y = "Frequency")+
  scale_x_continuous(limits = x_range, expand = c(0, 0))+
  theme(axis.title.x = element_text())
p1
#ggsave("../visualizations/shape-center-spread/epiderm/all_animals-micron-length-spread1.jpg", plot = p1, dpi = 300, width = 6, height = 4, units = "in")

p2<-ggplot(long2[], aes(x = value)) +
  geom_density(color="black", fill="darkgrey") +
  facet_wrap(~ name, scales = "fixed") +
   theme_minimal()+
  labs(x = "Pixel Value", y = "Frequency")+
  scale_x_continuous(limits = x_range, expand = c(0, 0))+
  theme(axis.title.x = element_text())
p2
#ggsave("../visualizations/shape-center-spread/epiderm/all_animals-micron-length-spread2.jpg", plot = p2, dpi = 300, width = 6, height = 4, units = "in")

p3<-ggplot(long3[], aes(x = value)) +
  geom_density(color="black", fill="darkgrey") +
  facet_wrap(~ name, scales = "fixed") +
   theme_minimal()+
  labs(x = "Pixel Value", y = "Frequency")+
  scale_x_continuous(limits = x_range, expand = c(0, 0))+
  theme(axis.title.x = element_text())
p3
#ggsave("../visualizations/shape-center-spread/epiderm/all_animals-micron-length-spread3.jpg", plot = p3, dpi = 300, width = 6, height = 4, units = "in")

p4<-ggplot(long4[], aes(x = value)) +
  geom_density(color="black", fill="darkgrey") +
  facet_wrap(~ name, scales = "fixed") +
   theme_minimal()+
  labs(x = "Pixel Value", y = "Frequency")+
  scale_x_continuous(limits = x_range, expand = c(0, 0))+
  theme(axis.title.x = element_text())
p4
#ggsave("../visualizations/shape-center-spread/epiderm/all_animals-micron-length-spread4.jpg", plot = p4, dpi = 300, width = 6, height = 4, units = "in")

p5<-ggplot(long5[], aes(x = value)) +
  geom_density(color="black", fill="darkgrey") +
  facet_wrap(~ name, scales = "fixed") +
   theme_minimal()+
  labs(x = "Pixel Value", y = "Frequency")+
  scale_x_continuous(limits = x_range, expand = c(0, 0))+
  theme(axis.title.x = element_text())
p5
#ggsave("../visualizations/shape-center-spread/epiderm/all_animals-micron-length-spread5.jpg", plot = p5, dpi = 300, width = 6, height = 4, units = "in")
```

### 1b. zoom in on select graphs
Only one graph example is shown
```{r warning=FALSE}

# plot using ggplot
# variables that chaneg are `long*[]` and `Animal_*`
targetAnimal_only <- long1[] %>% filter(startsWith(name, "Animal_A."))

p1<-ggplot(targetAnimal_only, aes(x = value)) +
  geom_density(fill = "blue", alpha = 0.5) +
  theme_minimal()+
  facet_wrap(~ name, scales = "fixed") +
  labs(x = "Pixel Value", y = "Frequency")+
  scale_x_continuous(limits = c(0,125), expand = c(0, 0))+
  theme(axis.title.x = element_text())
  ggsave("../visualizations/shape-center-spread/epiderm/Animal_A-micron-length-spread-zoomedView.jpg", plot=p1, dpi = 300, width = 6, height = 4, units = "in")

p2<-ggplot(targetAnimal_only, aes(x = value)) +
  geom_density(fill = "grey", color="transparent", alpha = 0.5) +
  theme_minimal()+
  facet_wrap(~ name, scales = "fixed") +
  labs(x = "Pixel Value", y = "Frequency")+
  scale_x_continuous(limits = c(0,125), expand = c(0, 0))+
  theme(axis.title.x = element_text())
  ggsave("../visualizations/shape-center-spread/epiderm/Animal_A-micron-length-spread-standardView.jpg", plot=p2, dpi = 300, width = 6, height = 4, units = "in")

```

## 3. FUNCTIONS for calculating metrics 

### 3a. Write funciton to unblind animal identities
```{r, unblind-fnc}
add_identity_unblind_column <- function(df) {
  # Define a lookup table of filename prefixes and corresponding identity_unblind values
  prefixes <- c("Animal_A.t" = "Exp17_Racemic-MAP_POD7_Mouse14",
                "Animal_C.t" = "Exp16_D-MAP_POD4_Mouse3",
                "Animal_D.t" = "Exp15_L-MAP_Mouse3_POD4",
                "Animal_F.t" = "Exp17_Racemic-MAP_POD7_Mouse11",
                "Animal_H.t" = "Exp17_Racemic-MAP_POD4_Mouse2",
                "Animal_I.t" = "Exp15_L-MAP_POD7_Mouse13",
                "Animal_J.t" = "Exp15_L-MAP_POD4_Mouse2",
                 "Animal_O.t" = "Exp17_Racemic-MAP_POD7_Mouse13",
                "Animal_W.t" = "Exp17_Racemic-MAP_POD7_Mouse12",
                "Animal_X.t" = "Exp14_No-MAP_POD4_Mouse2",
                "Animal_Y.t" = "Exp16_D-MAP_POD7_Mouse11",
                "Animal_Z1." = "Exp17_Racemic-MAP_POD4_Mouse1",
                "Animal_B." = "Exp15_POD7_Mouse11_L-MAP",
                "Animal_P." = "Exp14_POD7_Mouse13_D-MAP",
                "Animal_R." = "Exp16_POD7_Mouse2_D-MAP",
                "Animal_Z6." = "Exp16_POD7_Mouse11_D-MAP",
                "Animal_Z8." = "Exp16_POD4_Mouse2_D-MAP",
                 "Animal_Z3." = "Exp15_Mouse12_POD7_LMAP",
                "Animal_Z9." = "Exp17_POD4_Mouse3_Racemic-MAP",
                "Animal_Z10" = "Exp16_POD4_Mouse1_D-MAP",
               
                "Animal_E.t" = "Exp14_No-MAP_POD7_Mouse11",
                "Animal_K.t" = "Exp14_No-MAP_POD4_Mouse4",
                "Animal_L.t" = "Exp14_No-MAP_POD7_Mouse12",
                "Animal_M.t" = "Exp14_No-MAP_POD4_Mouse3",
                "Animal_U.t" = "Exp14_No-MAP_POD4_Mouse1",
                "Animal_Z2.t" = "Exp14_POD7_Mouse14_No-MAP",
                "Animal_Z4.t" = "Exp15_POD4_Mouse1",
                
                "Animal_G.t" = "Unmanipulated_PepB",
                "Animal_N.t" = "Unmanip_PepB",
                "Animal_V.t" = "Unmanip_B6",
                "Animal_Z.t" = "UnmanipB6")
                
                
  
  # Use sapply to look up the identity_unblind value for each filename in the dataframe
  df$identity_unblind <- sapply(df$filename, function(x) {
    prefix <- substr(x, 1, 10) # Extract the first 8 characters of the filename
    prefixes[prefix] # Look up the corresponding identity_unblind value
  })
  
  return(df)
}

```

### 3b. Write function to calculate sd of length for each column (aka each animal) 
```{r, fnc-to-calc-sd}
calculate_sd <- function(data) {
  # Calculate column-wise sd using sapply function
  std_deviations <- apply(data, 2, sd, na.rm = TRUE)
  
  # Create a new dataframe to store the column-wise averages
  sd_df <- data.frame(column = names(data), sd = std_deviations)
  
  # Return the new dataframe
  return(sd_df)
}
```

### 3b. Write function to calculate range (max-min) of length for each column (aka each animal) 
```{r, fnc-to-calc-range}
calculate_range <- function(data) {
  
 range_ <- function(vector){
   na_rm_values <- vector[!is.na(vector)]
    if (length(na_rm_values) <= 1) {
      return(NA)
    } else {
      return(max(na_rm_values) - min(na_rm_values))
    }
 }
 
  ranges <- apply(data, 2, range_)
  
  # Create a new dataframe to store the column-wise averages
  range_df <- data.frame(column = names(data), range = ranges)
  
  # Return the new dataframe
  return(range_df)
}

# first remove the NA values from each column using !is.na(x) and store non-NA values in na_rm_values 
# If there are at least two non-NA values  calculate the maximum minus the minimum using max(na_rm_values) - min(na_rm_values) otherwise return NA for that column.
```


### 3c. Write function to calculate iqr of length for each column (aka each animal) 
```{r, fnc-to-calc-iqr}
calculate_iqr <- function(data) {
  
 IQR_ <- function(vector){
   na_rm_values <- vector[!is.na(vector)]
   return(IQR(na_rm_values))
 }
 
  IQRs <- apply(data, 2, IQR_)
  
  # Create a new dataframe to store the column-wise averages
  iqr_df <- data.frame(column = names(data), iqr = IQRs)
  
  # Return the new dataframe
  return(iqr_df)
}

```

### 3d. Write function to calculate mean length for each column (aka each animal)
```{r, fnc-to-calcualte-averages}
# Define a function to calculate column-wise averages
calculate_averages <- function(data) {
  # Calculate column-wise averages using colMeans() function
  avg <- colMeans(data, na.rm = TRUE)
  
  # Create a new dataframe to store the column-wise averages
  avg_df <- data.frame(column = names(data), average = avg)
  
  # Return the new dataframe
  return(avg_df)
}
```

### 3e. Write function to calculate median length for each column (aka each animal)
```{r, fnc-to-calcualte-med}
# Define a function to calculate column-wise averages
calculate_median <- function(data) {
  # Calculate column-wise averages using colMeans() function
  med <- apply(data, 2, median, na.rm = TRUE)
  
  # Create a new dataframe to store the column-wise averages
  med_df <- data.frame(column = names(data), median = med)
  
  # Return the new dataframe
  return(med_df)
}
```

### 3f. Write function to calculate mode length for each column (aka each animal)
```{r, fnc-to-calcualte-mode}

calculate_mode <- function(data) {
  # round each number to ones place and find mode
  find_mode <- function(vector){
    na_rm_values <- vector[!is.na(vector)]
    
    na_rm_values <- round(na_rm_values)
    
     unique_vals <- unique(na_rm_values)
     counts <- tabulate(match(na_rm_values, unique_vals))
     modes <- unique_vals[counts == max(counts)]
  return(modes)
  }
  
  # Calculate column-wise modes function
  mode <- apply(data, 2, find_mode)
  
  # Create a new dataframe to store the column-wise modes
  mode_df <- data.frame(column = names(data), mode = mode)
  
  # Return the new dataframe
  return(mode_df)
}
```

### 3g. Write a master function that takes a function as an argument and unblinds the data frame and saves a dataframe where each column is the treatment received by the animal (nonop, op, map, etc.)


make dataframes (excel) that can be copied and pasted into prism and put them all on one excel doc just different sheets

aka one sheet for mean, median, mode, sd, range, etc.

```{r, master-fnc-prism}
# load library for making excel spreadhseet
library(writexl)


# call all metric functions on data

# write helper function to group animals by one of three treatment groups (MAP, NoMAP, Unmanipulated)
mutate_map <- function(df){
  return(mutate(df,treatment = case_when(
  identity_unblind %in% c("L-MAP", "D-MAP", "Racemic-MAP") ~ "MAP",
  identity_unblind == "No-MAP" ~ "NoMAP",
  identity_unblind == "Unmanip" ~ "Unmanipulated",
  TRUE ~ NA_character_
)))
}

#Write helper function to filter data for prism
filter_data_by_phrase <- function(df, phrase) {
  filtered_df <- df[grep(phrase, df$identity_unblind), ]
  return(filtered_df)
}

p1<- "Unmanipulated"
p2<-"NoMAP"
p3<-"MAP"

# Wrtie helper fucntion to deal with different lengths for filtered data made for prism
create_dataframe <- function(vec1, vec2, vec3, vec4, vec5) {
  # Get the maximum length of the vectors
  max_length <- max(length(vec1), length(vec2), length(vec3), length(vec4), length(vec5))
  
  # Pad shorter vectors with NAs
  vec1 <- c(vec1, rep(NA, max_length - length(vec1)))
  vec2 <- c(vec2, rep(NA, max_length - length(vec2)))
  vec3 <- c(vec3, rep(NA, max_length - length(vec3)))
  vec4 <- c(vec4, rep(NA, max_length - length(vec4)))
  vec5 <- c(vec5, rep(NA, max_length - length(vec5)))
  
  # Create the data frame
  df <- data.frame(vec1, vec2, vec3, vec4, vec5)
  return(df)
}

master <- function(data){
  # store all metric dataframes and add treatment labels
  sd_data <- add_identity_unblind_column(calculate_sd(data))
  range_data <- add_identity_unblind_column(calculate_range(data))
  iqr_data <- add_identity_unblind_column(calculate_iqr(data))
  
  mode_data <- add_identity_unblind_column(calculate_mode(data))
  med_data <- add_identity_unblind_column(calculate_median(data))
  avg_data <- add_identity_unblind_column(calculate_averages(data))
  
  # then mutate so any map treatment is grouped
  
    sd_data <- mutate_map(sd_data)
    range_data <- mutate_map(range_data)
    iqr_data <- mutate_map(iqr_data)
    
    mode_data <- mutate_map(mode_data)
    med_data <- mutate_map(med_data)
    avg_data <- mutate_map(avg_data)
  
  
  # and then make dataframe with a column each of the treatment groups (MAP, NoMAP, Unmanip)
    sd_data_sorted<-create_dataframe(
      (filter_data_by_phrase(sd_data, p1))$sd,
      (filter_data_by_phrase(sd_data, p2))$sd,
      (filter_data_by_phrase(sd_data, p3))$sd
      )
    range_data_sorted<-create_dataframe(
      (filter_data_by_phrase(range_data, p1))$range,
      (filter_data_by_phrase(range_data, p2))$range,
      (filter_data_by_phrase(range_data, p3))$range
      )
    iqr_data_sorted<-create_dataframe(
      (filter_data_by_phrase(iqr_data, p1))$iqr,
      (filter_data_by_phrase(iqr_data, p2))$iqr,
      (filter_data_by_phrase(iqr_data, p3))$iqr
      )
    
    mode_data_sorted<-create_dataframe(
      (filter_data_by_phrase(mode_data, p1))$mode,
      (filter_data_by_phrase(mode_data, p2))$mode,
      (filter_data_by_phrase(mode_data, p3))$mode
      )
    med_data_sorted<-create_dataframe(
      (filter_data_by_phrase(sd_data, p1))$median,
      (filter_data_by_phrase(sd_data, p2))$median,
      (filter_data_by_phrase(sd_data, p3))$median
      )
    mean_data_sorted<-create_dataframe(
      (filter_data_by_phrase(avg_data, p1))$average,
      (filter_data_by_phrase(avg_data, p2))$average,
      (filter_data_by_phrase(avg_data, p3))$average
      )
    
    #... and change column names
    colnames(sd_data_sorted) <- c("Unmanipulated", "NoMAP", "MAP")
    colnames(range_data_sorted) <- c("Unmanipulated", "NoMAP", "MAP")
    colnames(iqr_data_sorted) <- c("Unmanipulated", "NoMAP", "MAP")
    
    colnames(mode_data_sorted) <- c("Unmanipulated", "NoMAP", "MAP")
    colnames(med_data_sorted) <- c("Unmanipulated", "NoMAP", "MAP")
    colnames(mean_data_sorted) <- c("Unmanipulated", "NoMAP", "MAP")
    
    # then make excel spreadsheet where each df occupies one sheet
    # first Create a workbook object
    wb <- create_workbook()
    
    # then add data frames to separate sheets
  add_worksheet(wb, data = sd_data_sorted, sheetName = "Sheet1")
  add_worksheet(wb, data = range_data_sorted, sheetName = "Sheet2")
  add_worksheet(wb, data = iqr_data_sorted, sheetName = "Sheet3")
  add_worksheet(wb, data = mode_data_sorted, sheetName = "Sheet4")
  add_worksheet(wb, data = med_data_sorted, sheetName = "Sheet5")
  add_worksheet(wb, data = mean_data_sorted, sheetName = "Sheet6")
  
  # finally save the workbook to a file
save_workbook(wb, "../data/230523-prism-output.xlsx")
}
```

## 4. Use previous function to create dataframes for all metrics

### 4a. make df for SD's for each animal lengths
```{r, calc-averages}
# Call the calculate_averages() function to calculate the column-wise averages
all_epidermis_in_pixels_AVG <- calculate_averages(all_epidermis_lengths_in_pixels)
colnames(all_epidermis_in_pixels_AVG)<-c("filename", "average")
rownames(all_epidermis_in_pixels_AVG)<-c(1:length(rownames(all_epidermis_in_pixels_AVG)))

all_dermis_in_pixels_AVG <- calculate_averages(all_dermis_lengths_in_pixels)
colnames(all_dermis_in_pixels_AVG)<-c("filename", "average")
rownames(all_dermis_in_pixels_AVG)<-c(1:length(rownames(all_epidermis_in_pixels_AVG)))
```

### Visualize average pixel lengths (per animal) for epidermis/dermis 
Use bar chart
```{r, viz-animal-pixel-averages}
categories <- c(letters[1:16], "r", "u", "v", "w", "x", "y", "z", "z1", "z10", "z2", "z4", "z6", "z8", "z9")

# for epidermis
df1<- cbind(all_epidermis_in_pixels_AVG, categories)
p1<-ggplot(df1, aes(x = categories, y = all_epidermis_in_pixels_AVG[,2])) +
  geom_bar(stat = "identity", color="black", fill="white") +
  xlab("Animal") +
  ylab("Average Length of Epidermis in pixels")
p1

ggsave("avg-epidermis-pixel-length-by-animal.jpg", plot = p1, dpi = 300, width = 6, height = 4, units = "in")

# for dermis
df2<- cbind(all_dermis_in_pixels_AVG, categories)
p2<-ggplot(df2, aes(x = categories, y = all_epidermis_in_pixels_AVG[,2])) +
  geom_bar(stat = "identity", color="black", fill="white") +
  xlab("Animal") +
  ylab("Average Length of Dermis in pixels")
p2

ggsave("avg-dermis-pixel-length-by-animal.jpg", plot = p2, dpi = 300, width = 6, height = 4, units = "in")
```


### save blinded average pixel length df's for epidermis and dermis
```{r, save-blind-avg-pixel-dermis-and-epidermis-dfs}
## ONLY RUN IF DATAFRAMS NOT ALREADY SAVED!

write.csv(df1, file=paste0("../data/","blind_avg_epidermis_lengths_in_pixels.csv"))
write.csv(df2, file=paste0("../data/","blind_avg_dermis_lengths_in_pixels.csv"))
```



### Use previous function to unblind epidermis and dermis df's
```{r, use-unblind-fnc}
unblind_all_epidermis_in_pixels_AVG <- add_identity_unblind_column(all_epidermis_in_pixels_AVG)

unblind_all_dermis_in_pixels_AVG <- add_identity_unblind_column(all_dermis_in_pixels_AVG)
```

### save the unblind epidermis and dermis dfs
```{r, save-ublinded-dfs}
# ONLY RUN IF THESE DF's AREN'T ALREADY SAVED!!
write.csv(unblind_all_epidermis_in_pixels_AVG, file=paste0("../data/","unblind_avg_epidermis_lengths_in_pixels.csv"))

write.csv(unblind_all_dermis_in_pixels_AVG, file=paste0("../data/","unblind_avg_dermis_lengths_in_pixels.csv"))
```

### Prism graphs
#### Write function to filter data for prism
```{r, filter-prism-fnc}
# get only the unmanip
filter_data_by_phrase <- function(df, phrase) {
  filtered_df <- df[grep(phrase, df$identity_unblind), ]
  return(filtered_df)
}

# This function takes two parameters: df, which is the data frame to be filtered, and phrase, which is the phrase to search for in the "identity_unblind" column. The grep() function is used to search for the given phrase in the "identity_unblind" column, and the resulting indices are used to subset the original data frame.
```

#### Wrtie fucntion to deal with different lengths for filtered data made for prism
```{r, df-length-fnc}
create_dataframe <- function(vec1, vec2, vec3, vec4, vec5) {
  # Get the maximum length of the vectors
  max_length <- max(length(vec1), length(vec2), length(vec3), length(vec4), length(vec5))
  
  # Pad shorter vectors with NAs
  vec1 <- c(vec1, rep(NA, max_length - length(vec1)))
  vec2 <- c(vec2, rep(NA, max_length - length(vec2)))
  vec3 <- c(vec3, rep(NA, max_length - length(vec3)))
  vec4 <- c(vec4, rep(NA, max_length - length(vec4)))
  vec5 <- c(vec5, rep(NA, max_length - length(vec5)))
  
  # Create the data frame
  df <- data.frame(vec1, vec2, vec3, vec4, vec5)
  return(df)
}

```

#### Use the previous two functions to filter data for prism part 1
```{r, use-filter-prism-fnc}
p1<- "Unmanip"
p2<-"No-MAP"
p3<-"L-MAP"
p4<-"D-MAP"
p5<-"Racemic-MAP"

# for epiderm

# deal with different lengths
all_epidermal_pixel_thickness_prismDf<-create_dataframe((filter_data_by_phrase(unblind_all_epidermis_in_pixels_AVG, p1))$average,
      (filter_data_by_phrase(unblind_all_epidermis_in_pixels_AVG, p2))$average,
      (filter_data_by_phrase(unblind_all_epidermis_in_pixels_AVG, p3))$average,
      (filter_data_by_phrase(unblind_all_epidermis_in_pixels_AVG, p4))$average,
      (filter_data_by_phrase(unblind_all_epidermis_in_pixels_AVG, p5))$average)
colnames(all_epidermal_pixel_thickness_prismDf) <- c("NonOp", "No MAP", "L-MAP", "D-MAP", "R-MAP")
View(all_epidermal_pixel_thickness_prismDf)

# for derm
all_dermal_pixel_thickness_prismDf<-create_dataframe((filter_data_by_phrase(unblind_all_dermis_in_pixels_AVG, p1))$average,
      (filter_data_by_phrase(unblind_all_dermis_in_pixels_AVG, p2))$average,
      (filter_data_by_phrase(unblind_all_dermis_in_pixels_AVG, p3))$average,
      (filter_data_by_phrase(unblind_all_dermis_in_pixels_AVG, p4))$average,
      (filter_data_by_phrase(unblind_all_dermis_in_pixels_AVG, p5))$average)
colnames(all_dermal_pixel_thickness_prismDf) <- c("NonOp", "No MAP", "L-MAP", "D-MAP", "R-MAP")
View(all_dermal_pixel_thickness_prismDf)
```

#### save the prism df's made in the previous chunk
```{r, save-prism-dfs}
# ONLY RUN IF THESE DF's AREN'T ALREADY SAVED!!
write.csv(epidermal_thickness_prismDf, file=paste0("../data/","all_epidermal_pixel_thickness_prismDf.csv"))

write.csv(dermal_thickness_prismDf, file=paste0("../data/","all_dermal_pixel_thickness_prismDf.csv"))
```

#### export to github for prism part 1
Run the following in terminal
git add ../data/all_epidermal_pixel_thickness_prismDf.csv 
git add ../data/all_dermal_pixel_thickness_prismDf.csv 
git commit -m "add prism part1 file"
git push

Then go to github and copy paste into excel
Then copy and past into prism


#### Use the previous two functions to filter data for prism part 2 (POD4 & POD7)
When copyign and pasting remember to exclude 1st column which is placeholder repeat
```{r, use-filter-prism-fnc}
p2<-"No-MAP"
p3<-"L-MAP"
p4<-"D-MAP"
p5<-"Racemic-MAP"

# POD4----------------------
# for epiderm
#first filter by pod4
df1<-filter_data_by_phrase(unblind_all_epidermis_in_pixels_AVG, "POD4")

# deal with different lengths
pod4_epidermal_pixel_thickness_prismDf<-create_dataframe(
      c(NA),
      (filter_data_by_phrase(df1, p2))$average,
      (filter_data_by_phrase(df1, p3))$average,
      (filter_data_by_phrase(df1, p4))$average,
      (filter_data_by_phrase(df1, p5))$average)
colnames(pod4_epidermal_pixel_thickness_prismDf) <- c("don't copy this column","No MAP", "L-MAP", "D-MAP", "R-MAP")
View(pod4_epidermal_pixel_thickness_prismDf)

# for derm
#first filter by pod4
df2<-filter_data_by_phrase(unblind_all_dermis_in_pixels_AVG, "POD4")

# deal with different lengths
pod4_dermal_pixel_thickness_prismDf<-create_dataframe(
      c(NA),
      (filter_data_by_phrase(df2, p2))$average,
      (filter_data_by_phrase(df2, p3))$average,
      (filter_data_by_phrase(df2, p4))$average,
      (filter_data_by_phrase(df2, p5))$average)
colnames(pod4_dermal_pixel_thickness_prismDf) <- c("don't copy this column", "No MAP", "L-MAP", "D-MAP", "R-MAP")
View(pod4_dermal_pixel_thickness_prismDf)

# POD7----------------------
# for epiderm
#first filter by pod4
df1<-filter_data_by_phrase(unblind_all_epidermis_in_pixels_AVG, "POD7")

# deal with different lengths
pod7_epidermal_pixel_thickness_prismDf<-create_dataframe(
      c(NA),    
      (filter_data_by_phrase(df1, p2))$average,
      (filter_data_by_phrase(df1, p3))$average,
      (filter_data_by_phrase(df1, p4))$average,
      (filter_data_by_phrase(df1, p5))$average)
colnames(pod7_epidermal_pixel_thickness_prismDf) <- c("don't copy this column","No MAP", "L-MAP", "D-MAP", "R-MAP")
View(pod7_epidermal_pixel_thickness_prismDf)

# for derm
#first filter by pod4
df2<-filter_data_by_phrase(unblind_all_dermis_in_pixels_AVG, "POD7")

# deal with different lengths
pod7_dermal_pixel_thickness_prismDf<-create_dataframe(
      c(NA),    
      (filter_data_by_phrase(df2, p2))$average,
      (filter_data_by_phrase(df2, p3))$average,
      (filter_data_by_phrase(df2, p4))$average,
      (filter_data_by_phrase(df2, p5))$average)
colnames(pod7_dermal_pixel_thickness_prismDf) <- c("don't copy this column","No MAP", "L-MAP", "D-MAP", "R-MAP")
View(pod7_dermal_pixel_thickness_prismDf)
```

#### save the prism df's made in the previous chunk
```{r, save-prism-dfs}
# ONLY RUN IF THESE DF's AREN'T ALREADY SAVED!!
write.csv(pod4_epidermal_pixel_thickness_prismDf, file=paste0("../data/","pod4_epidermal_pixel_thickness_prismDf.csv"))
write.csv(pod4_dermal_pixel_thickness_prismDf, file=paste0("../data/","pod4_dermal_pixel_thickness_prismDf.csv"))

write.csv(pod7_epidermal_pixel_thickness_prismDf, file=paste0("../data/","pod7_epidermal_pixel_thickness_prismDf.csv"))
write.csv(pod7_dermal_pixel_thickness_prismDf, file=paste0("../data/","pod7_dermal_pixel_thickness_prismDf.csv"))
```

#### export to github for prism part 2
Run the following in terminal
git add ../data/pod4_epidermal_pixel_thickness_prismDf.csv 
git add ../data/pod4_dermal_pixel_thickness_prismDf.csv 
git add ../data/pod7_epidermal_pixel_thickness_prismDf.csv
git add ../data/pod7_dermal_pixel_thickness_prismDf.csv 
git commit -m "add prism part2 file"
git push

Then go to github and copy paste into excel
Then copy and past into prism